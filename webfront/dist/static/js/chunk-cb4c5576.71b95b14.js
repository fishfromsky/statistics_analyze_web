(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cb4c5576"],{"0800":function(t,e,i){"use strict";var a=i("903c0"),s=i.n(a);s.a},"631a":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-select",{staticClass:"filter-item",staticStyle:{width:"100px"},attrs:{placeholder:"项目编号",clearable:""},model:{value:t.listQuery.project_id,callback:function(e){t.$set(t.listQuery,"project_id",e)},expression:"listQuery.project_id"}},t._l(t.project_idOptions,(function(t){return i("el-option",{key:t,attrs:{label:t,value:t}})})),1),t._v(" "),i("el-input",{staticClass:"filter-item",staticStyle:{width:"100px"},attrs:{placeholder:"p值"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.listQuery.p,callback:function(e){t.$set(t.listQuery,"p",e)},expression:"listQuery.p"}}),t._v(" "),i("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},on:{change:t.handleFilter},model:{value:t.listQuery.sort,callback:function(e){t.$set(t.listQuery,"sort",e)},expression:"listQuery.sort"}},t._l(t.sortOptions,(function(t){return i("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})})),1),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("\n      查询\n    ")]),t._v(" "),i("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleCreate}},[t._v("\n      新增\n    ")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-download"},on:{click:t.handleDownload}},[t._v("\n      下载\n    ")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-upload2"},on:{click:t.showHandleUpload}},[t._v("\n      上传\n    ")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-delete-solid"},on:{click:t.showHandleClear}},[t._v("\n      清空\n    ")]),t._v(" "),i("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-s-marketing"},on:{click:t.getCost}},[t._v("\n      数据可视化\n    ")]),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisibleupload},on:{"update:visible":function(e){t.dialogFormVisibleupload=e}}},[i("upload-excel-component",{attrs:{"on-success":t.handleSuccess,"before-upload":t.beforeUpload}}),t._v(" "),i("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:t.tableData,border:"","highlight-current-row":""}},t._l(t.tableHeader,(function(t){return i("el-table-column",{key:t,attrs:{prop:t,label:t}})})),1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"title"},slot:"title"},[i("el-button",{on:{click:t.hideHandleUpload}},[t._v("\n          取消\n        ")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.handleUpload}},[t._v("\n          确认\n        ")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisibleclear},on:{"update:visible":function(e){t.dialogFormVisibleclear=e}}},[i("p",[t._v("确认清空筛选的数据吗？")]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.hideHandleClear}},[t._v("\n          不清空\n        ")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.handleClear}},[t._v("\n          确认清空\n        ")])],1)])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""},on:{"sort-change":t.sortChange}},[i("el-table-column",{attrs:{label:"项目编号",width:"200.0px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",[t._v(t._s(a.project_id))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"p值",width:"200.0px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",[t._v(t._s(a.p))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"交通成本",width:"200.0px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",[t._v(t._s(a.transport_cost))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"规模成本",width:"200.0px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",[t._v(t._s(a.scale_cost))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"总成本",width:"200.0px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("span",[t._v(t._s(a.total_cost))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作",align:"center",width:"250","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,s=e.$index;return["deleted"!=a.status?i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(a,s)}}},[t._v("\n          删除\n        ")]):t._e()]}}])})],1),t._v(" "),i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getList}}),t._v(" "),t.chart_visible?i("div",{staticClass:"chart-wrapper",staticStyle:{"margin-top":"30px"}},[i("bar-chart",{attrs:{"chart-data":t.barchart}})],1):t._e(),t._v(" "),i("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"500px","margin-left":"100px"},attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"150px"}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("\n        取消\n      ")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData()}}},[t._v("\n        确认\n      ")])],1)],1),t._v(" "),i("el-dialog",{attrs:{visible:t.dialogPvVisible,title:"Reading statistics"},on:{"update:visible":function(e){t.dialogPvVisible=e}}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.pvData,border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{prop:"key",label:"Channel"}}),t._v(" "),i("el-table-column",{attrs:{prop:"pv",label:"Pv"}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dialogPvVisible=!1}}},[t._v("确认")])],1)],1)],1)},s=[],n=(i("55dd"),i("7f7f"),i("20d6"),i("3796")),l=i("b775");function o(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/list",method:"get",params:t})}function r(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/pv",method:"get",params:{pv:t}})}function c(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/cost",method:"get",params:{project_id:t}})}function d(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/create",method:"post",data:t})}function u(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/update",method:"post",data:t})}function p(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/delete",method:"post",data:t})}function h(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/download",method:"get",params:t})}function f(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/upload",method:"post",data:t})}function m(t){return Object(l["a"])({url:"/api/pmedianoutputcomx/clear",method:"post",params:t})}var v=i("6724"),b=i("ed08"),g=i("333d"),_=i("1146"),y=i.n(_),w=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.className,style:{width:t.width,height:t.height}})},x=[],k=i("313e"),$=i.n(k),S={data:function(){return{$_sidebarElm:null,$_resizeHandler:null}},mounted:function(){var t=this;this.$_resizeHandler=Object(b["a"])((function(){t.chart&&t.chart.resize()}),100),this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},beforeDestroy:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},activated:function(){this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},deactivated:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},methods:{$_initResizeEvent:function(){window.addEventListener("resize",this.$_resizeHandler)},$_destroyResizeEvent:function(){window.removeEventListener("resize",this.$_resizeHandler)},$_sidebarResizeHandler:function(t){"width"===t.propertyName&&this.$_resizeHandler()},$_initSidebarResizeEvent:function(){this.$_sidebarElm=document.getElementsByClassName("sidebar-container")[0],this.$_sidebarElm&&this.$_sidebarElm.addEventListener("transitionend",this.$_sidebarResizeHandler)},$_destroySidebarResizeEvent:function(){this.$_sidebarElm&&this.$_sidebarElm.removeEventListener("transitionend",this.$_sidebarResizeHandler)}}};i("56a5");var C=6e3,D={name:"BarChart",mixins:[S],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"350px"},autoResize:{type:Boolean,default:!0},chartData:{type:Object,required:!0}},data:function(){return{chart:null}},watch:{chartData:{deep:!0,handler:function(t){this.setOptions(t)}}},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()}))},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{initChart:function(){this.chart=$.a.init(this.$el,"westeros"),this.setOptions(this.chartData)},setOptions:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.model1,i=t.model2,a=t.p;this.chart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:10,left:"2%",right:"2%",bottom:"3%",containLabel:!0},xAxis:[{name:"集散厂数量",type:"category",data:a,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:0}}],yAxis:[{name:"万元",type:"value",axisTick:{show:!1}}],series:[{name:"交通成本",type:"bar",stack:"vistors",barWidth:"60%",data:e,color:"#59C4E6",animationDuration:C},{name:"规模成本",type:"bar",stack:"vistors",barWidth:"60%",data:i,color:"#EDAFDA",animationDuration:C}]})}}},F=D,j=i("2877"),E=Object(j["a"])(F,w,x,!1,null,"15f641ec",null),O=E.exports,z={name:"ComplexTable",components:{Pagination:g["a"],UploadExcelComponent:n["a"],BarChart:O},directives:{waves:v["a"]},filters:{statusFilter:function(t){var e={published:"success",draft:"info",deleted:"danger"};return e[t]}},data:function(){return{tableData:[],tableHeader:[],tableKey:0,list:null,total:0,listLoading:!0,project_idOptions:[],chart_visible:!1,barchart:{model1:[],model2:[],p:[]},listQuery:{page:1,limit:20,project_id:void 0,p:void 0,sort:"-id"},sortOptions:[{label:"升序",key:"+id"},{label:"降序",key:"-id"}],temp:{id:void 0},dialogFormVisible:!1,dialogFormVisibleupload:!1,dialogFormVisibleclear:!1,dialogStatus:"",textMap:{update:"Edit",create:"Create"},dialogPvVisible:!1,pvData:[],rules:{}}},created:function(){this.getList()},methods:{beforeUpload:function(t){var e=t.size/1024/1024<1;return!!e||(this.$message({message:"Please do not upload files larger than 1m in size.",type:"warning"}),!1)},handleSuccess:function(t){var e=t.results,i=t.header;this.tableData=e,this.tableHeader=i},getList:function(){var t=this;this.listLoading=!0,o(this.listQuery).then((function(e){t.list=e.data.items,t.total=e.data.total,t.project_idOptions=e.unique_project_id,setTimeout((function(){t.listLoading=!1}),1500)}))},getCost:function(){var t=this;void 0===this.listQuery.project_id?this.$message.error("请填写项目ID"):c(this.listQuery.project_id).then((function(e){t.barchart.model1=e.transport_cost,t.barchart.model2=e.scale_cost,t.barchart.p=e.p,t.chart_visible=!0,window.scrollTo(0,5e4)}))},handleFilter:function(){this.listQuery.page=1,this.getList()},handleModifyStatus:function(t,e){this.$message({message:"操作Success",type:"success"}),t.status=e},sortChange:function(t){var e=t.prop,i=t.order;"id"===e&&this.sortByID(i)},sortByID:function(t){this.listQuery.sort="ascending"===t?"+id":"-id",this.handleFilter()},resetTemp:function(){this.temp={id:void 0}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick((function(){t.$refs["dataForm"].clearValidate()}))},createData:function(){var t=this;this.$refs["dataForm"].validate((function(e){e&&d(t.temp).then((function(){t.list.unshift(t.temp),t.dialogFormVisible=!1,t.$notify({title:"Success",message:"Created Successfully",type:"success",duration:2e3})}))}))},handleUpdate:function(t){var e=this;this.temp=Object.assign({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick((function(){e.$refs["dataForm"].clearValidate()}))},updateData:function(){var t=this;this.$refs["dataForm"].validate((function(e){if(e){var i=Object.assign({},t.temp);u(i).then((function(){var e=t.list.findIndex((function(e){return e.id===t.temp.id}));t.list.splice(e,1,t.temp),t.dialogFormVisible=!1,t.$notify({title:"Success",message:"Update Successfully",type:"success",duration:2e3})}))}}))},handleDelete:function(t,e){var i=this;this.list.splice(e,1),console.log(t.id),p(t.id).then((function(){i.$notify({title:"Success",message:"Update Successfully",type:"success",duration:2e3})}))},handleFetchPv:function(t){var e=this;r(t).then((function(t){e.pvData=t.data.pvData,e.dialogPvVisible=!0}))},handleDownload:function(){var t=this;this.listLoading=!0,h(this.listQuery).then((function(e){t.list=e.data.items;var a=["项目编号","p值","交通成本","规模成本","总成本"],s=["project_id","p","transport_cost","scale_cost","total_cost"],n=t.formatJson(s);Promise.all([i.e("chunk-25372fd9"),i.e("chunk-748b566e")]).then(i.bind(null,"4bf8d")).then((function(t){t.export_json_to_excel({header:a,data:n,filename:"Pmedian输出Cost"})})),console.log("test13.................")})),this.listLoading=!1},showHandleUpload:function(){this.dialogFormVisibleupload=!0},showHandleClear:function(){this.dialogFormVisibleclear=!0},hideHandleUpload:function(){this.dialogFormVisibleupload=!1},hideHandleClear:function(){this.dialogFormVisibleclear=!1},handleClear:function(){var t=this;this.listLoading=!0,this.dialogFormVisibleclear=!1,m(this.listQuery).then((function(){t.$notify({title:"Success",message:"清空成功",type:"success",duration:2e3})})),this.listLoading=!1,location.reload()},handleUpload:function(){var t=this;this.dialogFormVisibleupload=!1,console.log("handleUpload.................."),console.log("this.tableData",this.tableData),f(this.tableData).then((function(){t.$notify({title:"Success",message:"上传成功",type:"success",duration:2e3})})),location.reload()},handleClick:function(t){console.log("handleClick................................................");var e=t.target.files,i=e[0];i&&this.upload(i)},upload:function(t){if(this.$refs["excel-upload-input"].value=null,console.log("upload................................................"),this.beforeUpload){var e=this.beforeUpload(t);e&&this.readerData(t)}else this.readerData(t)},readerData:function(t){var e=this;return this.loading=!0,new Promise((function(i,a){var s=new FileReader;s.onload=function(t){var a=t.target.result,s=y.a.read(a,{type:"array"}),n=s.SheetNames[0],l=s.Sheets[n],o=e.getHeaderRow(l),r=y.a.utils.sheet_to_json(l);e.generateData({header:o,results:r}),e.loading=!1,i()},s.readAsArrayBuffer(t)}))},getHeaderRow:function(t){var e,i=[],a=y.a.utils.decode_range(t["!ref"]),s=a.s.r;for(e=a.s.c;e<=a.e.c;++e){var n=t[y.a.utils.encode_cell({c:e,r:s})],l="UNKNOWN "+e;n&&n.t&&(l=y.a.utils.format_cell(n)),i.push(l)}return i},isExcel:function(t){return/\.(xlsx|xls|csv)$/.test(t.name)},formatJson:function(t){return this.list.map((function(e){return t.map((function(t){return"timestamp"===t?Object(b["b"])(e[t]):e[t]}))}))},getSortClass:function(t){var e=this.listQuery.sort;return e==="+".concat(t)?"ascending":"descending"}}},V=z,Q=(i("0800"),Object(j["a"])(V,a,s,!1,null,"c8b0898e",null));e["default"]=Q.exports},"903c0":function(t,e,i){}}]);