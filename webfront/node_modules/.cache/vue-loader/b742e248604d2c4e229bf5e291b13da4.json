{"remainingRequest":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectsAll\\statistics_analyze_web\\webfront\\src\\views\\crawldata\\garbagedata\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\src\\views\\crawldata\\garbagedata\\index.vue","mtime":1609073358356},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport {getnationpm, getnationwaterpollution, getnationsolidpollution, getworldpm, getCrawlDataRecord, deleteCrawlData, selectCrawlRecord } from '@/api/model'\r\nexport default {\r\n  components: {\r\n  },\r\n  data() {\r\n    return {\r\n      level: '',\r\n      kind: '',\r\n      year: '',\r\n      showHistory: false,\r\n      input_key_word: '',\r\n      count: '',\r\n      table_loading: false,\r\n      tablekey: 0,\r\n      tableData: [],\r\n      page_data: [],\r\n      formData: [],\r\n      delete_dialog: false,\r\n      delete_id: '',\r\n      total_size: 0,\r\n      currentPage: 1,\r\n      page_size: 10,\r\n      excel_url: '',\r\n      startYear: '',\r\n      endYear: '',\r\n      district: '',\r\n      table_type: '',\r\n      excel_download: false,\r\n      data_loading: false,\r\n      form: {\r\n        table_kind: '',\r\n        key_word: '',\r\n        startYear: '',\r\n        endYear: '',\r\n        count: '',\r\n        district: ''\r\n       },\r\n       listQuery: {\r\n        table_type: '',\r\n        year: '',\r\n        key_words: '',\r\n        city: ''\r\n       },\r\n      year_option: [],\r\n      kw_option: [],\r\n      city_option: [],\r\n      level_option: [\r\n        {\r\n          value: '1',\r\n          label: '国内空气污染数据'\r\n        },\r\n        {\r\n          value: '2',\r\n          label: '国内水体污染数据'\r\n        },\r\n        {\r\n          value: '3',\r\n          label: '国内固体废物数据'\r\n        }\r\n      ],\r\n      kind_option: [\r\n        {\r\n          value: '垃圾',\r\n          label: '垃圾'\r\n        },\r\n        {\r\n          value: '废弃物',\r\n          label: '废弃物'\r\n        },\r\n        {\r\n          value: '回收',\r\n          label: '回收'\r\n        },\r\n        {\r\n          value: '塑料',\r\n          label: '塑料'\r\n        },\r\n        {\r\n          value: '金属',\r\n          label: '金属'\r\n        },\r\n        {\r\n          value: '纸业',\r\n          label: '纸业'\r\n        },\r\n        {\r\n          value: '其他',\r\n          label: '其他',\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  watch: {\r\n\r\n  },\r\n  methods: {\r\n    getData() {\r\n      var that = this\r\n      if (that.level === '') {\r\n        that.$message.error('数据种类不能为空')\r\n      } else if (that.level === '1') {\r\n        this.form.table_kind = that.level\r\n        let data = this.form\r\n        this.data_loading = true\r\n        this.excel_download = false\r\n        getnationpm(data).then(res=>{\r\n          if(res.code === 20000) {\r\n            this.$message({\r\n              type: 'success',\r\n              message: 'success'\r\n            })\r\n            this.data_loading = false\r\n            this.excel_download = true\r\n            this.excel_url = res.excel_url\r\n          }\r\n          this.data_loading = false\r\n        })\r\n      } else if (that.level === '2') {\r\n        this.form.table_kind = that.level\r\n        let data = this.form\r\n        this.data_loading = true\r\n        this.excel_download = false\r\n        getnationwaterpollution(data).then(res=>{\r\n          if(res.code === 20000) {\r\n            this.$message({\r\n              type: 'success',\r\n              message: 'success'\r\n            })\r\n            this.data_loading = false\r\n            this.excel_download = true\r\n            this.excel_url = res.excel_url\r\n          }\r\n          this.data_loading = false\r\n        })\r\n      } else if (that.level === '3') {\r\n        if (that.kind === '' || that.count === '' || that.startYear === '' || that.endYear === '') {\r\n          that.$message.error('请填写完整数据！')\r\n        } else {\r\n            if (that.kind === '其他') {\r\n              this.form.key_word = that.input_key_word\r\n            } else {\r\n              this.form.key_word = that.kind\r\n            }\r\n            if ( that.startYear > that.endYear ) {\r\n              that.$message.error('请填写正确的时间区间！')\r\n            } else {\r\n                    this.form.table_kind = that.level\r\n                    this.form.startYear = that.startYear\r\n                    this.form.endYear = that.endYear\r\n                    this.form.count = that.count\r\n                    this.form.district = that.district\r\n                    let data = this.form\r\n                    this.data_loading = true\r\n                    this.excel_download = false\r\n                    getnationsolidpollution(data).then(res=>{\r\n                    if(res.code === 20000) {\r\n                      this.$message({\r\n                        type: 'success',\r\n                        message: 'success'\r\n                    })\r\n                    this.data_loading = false\r\n                    this.excel_download = true\r\n                    this.excel_url = res.excel_url\r\n                    }\r\n                    this.data_loading = false\r\n                    })\r\n                  }\r\n        }\r\n      }\r\n    },\r\n    getHistory() {\r\n      let that = this\r\n      if (that.level === '') {\r\n        that.$message.error('数据种类不能为空')\r\n      } else {\r\n        if (that.level === '1'){\r\n          that.table_type = '国内空气污染数据'\r\n        } else if (that.level === '2'){\r\n          that.table_type = '国内水体污染数据'\r\n        } else if (that.level === '3') {\r\n          that.table_type = '国内固体废物数据'\r\n        }\r\n        this.showHistory = true\r\n        getCrawlDataRecord(that.table_type).then(res=>{\r\n                if (res.code === 20000){\r\n                    that.table_loading = false\r\n                    that.tableData = res.data\r\n                    let size = that.page_size\r\n                    let index = that.currentPage-1\r\n                    that.page_data = []\r\n                    for (let i=index*size; i<(index+1)*size; i++){\r\n                        if (i==res.data.length){\r\n                            break\r\n                        }\r\n                        that.page_data.push(res.data[i])\r\n                    }\r\n                    that.total_size = res.data.length\r\n                    that.year_option = res.unique_year_list\r\n                    that.kw_option = res.unique_kw_list\r\n                    that.city_option = res.unique_city_list\r\n                }\r\n            })\r\n      }\r\n    },\r\n    handleFilter() {\r\n      let that = this\r\n      that.listQuery.table_type = that.table_type\r\n      selectCrawlRecord(that.listQuery).then(res=>{\r\n                if (res.code === 20000){\r\n                    that.table_loading = false\r\n                    that.tableData = res.data\r\n                    let size = that.page_size\r\n                    let index = that.currentPage-1\r\n                    that.page_data = []\r\n                    this.$message({\r\n              type: 'success',\r\n              message: res.data\r\n            })\r\n                    for (let i=index*size; i<(index+1)*size; i++){\r\n                        if (i==res.data.length){\r\n                            break\r\n                        }\r\n                        that.page_data.push(res.data[i])\r\n                    }\r\n                    that.total_size = res.data.length\r\n                    that.year_option = res.unique_year_list\r\n                    that.kw_option = res.unique_kw_list\r\n                    that.city_option = res.unique_city_list\r\n                }\r\n            })\r\n    },\r\n    deleteData(id) {\r\n      this.delete_dialog = true\r\n      this.delete_id = id\r\n    },\r\n    deleteDataConfirm() {\r\n      deleteCrawlData(this.delete_id).then(res=>{\r\n        if(res.code === 20000){\r\n          this.$message({\r\n            type: 'success',\r\n            message: '删除成功'\r\n          })\r\n          this.delete_dialog = false\r\n          this.getHistory()\r\n        }\r\n      }\r\n      )\r\n    },\r\n    handleSizeChange(val){\r\n            this.table_loading = true\r\n            this.page_size = val\r\n            this.currentPage = 1\r\n            this.page_data = []\r\n            this.getHistory()\r\n    },\r\n    handleCurrentChange(val){\r\n            this.currentPage = val\r\n            this.page_data = []\r\n            this.getHistory()\r\n    }\r\n  },\r\n  mounted() {\r\n  }\r\n}\r\n",null]}