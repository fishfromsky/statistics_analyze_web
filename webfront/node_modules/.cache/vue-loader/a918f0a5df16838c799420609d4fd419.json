{"remainingRequest":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectsAll\\statistics_analyze_web\\webfront\\src\\views\\repository\\relation\\manage\\components\\tabledata.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\src\\views\\repository\\relation\\manage\\components\\tabledata.vue","mtime":1621249997099},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web\\webfront\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getrelationfilelist, getrelationproject, getexcelinfo, startrelation, addrelationproject, amendrelationproject } from \"@/api/model\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      tableshow: true,\r\n      table_loading: false,\r\n      tablekey: 0,\r\n      tableData: [],\r\n      page_data: [],\r\n      total_size: 0,\r\n      currentPage: 1,\r\n      page_size: 10,\r\n      fileData: [],\r\n      choose_data_dialog: false,\r\n      selectdata: null,\r\n      selected_project_index: null,\r\n      selectfilePath: null,\r\n      select_cols: null,\r\n      select_cols_num: null,\r\n      choose_col_dialog: false,\r\n      reference_col: null,\r\n      checkList: [],\r\n      add_form: {},\r\n      add_dialog: false,\r\n      form: {},\r\n      amend_dialog: false,\r\n      choose_dialog: false,\r\n      choose_value: null,\r\n      choose_item: [\r\n        { value: '1', label: '相关矩阵'},\r\n        { value: '2', label: '随机森林'},\r\n        { value: '3', label: '灰度分析'},\r\n        { value: '4', label: '皮尔逊系数'}\r\n      ],\r\n    };\r\n  },\r\n  watch: {\r\n    selectdata(val) {\r\n      let that = this;\r\n      let data = {};\r\n      data[\"url\"] = this.fileData[val].path;\r\n      this.selectfilePath = this.fileData[val].path;\r\n      getexcelinfo(data).then((res) => {\r\n        if (res.code === 20000) {\r\n          that.select_cols = res.cols;\r\n          that.select_cols_num = res.col_num;\r\n        }\r\n      });\r\n    },\r\n  },\r\n  methods: {\r\n    isInArray(arr, item){\r\n      for (let i=0; i<arr.length; i++){\r\n        if (arr[i] === item){\r\n          return true\r\n        }\r\n      }\r\n      return false\r\n    },\r\n    AmendData(index){\r\n        this.form = this.page_data[index]\r\n        this.amend_dialog = true\r\n    },\r\n    AmendDataConfirm:function(){\r\n      let that = this\r\n      amendrelationproject(this.form).then(res=>{\r\n        if (res.code === 20000){\r\n          this.$message({\r\n            type: 'success',\r\n            message: '修改成功'\r\n          })\r\n          that.amend_dialog = false\r\n          that.table_loading = true;\r\n          that.page_data = [];\r\n          that.tableData = [];\r\n          that.getData();\r\n        }\r\n      })\r\n    },\r\n    addPrograme:function(){\r\n      this.add_dialog = true\r\n    },\r\n    addDataConfirm:function(){\r\n      let data = this.add_form\r\n      if (this.add_form.project_id === ''){\r\n          this.$message.error('请输入项目ID')\r\n      }\r\n      else if (this.add_form.name === ''){\r\n          this.$message.error('请输入项目名称')\r\n      }\r\n      else{\r\n        let that = this\r\n        addrelationproject(this.add_form).then(res=>{\r\n          if (res.code === 20000){\r\n            this.$message({\r\n              type: 'success',\r\n              message: '添加成功'\r\n            })\r\n            that.add_dialog = false\r\n            that.table_loading = true;\r\n            that.page_data = [];\r\n            that.tableData = [];\r\n            that.getData();\r\n          }\r\n        })\r\n      }\r\n    },\r\n    Select_Index: function (arr_main, arr_child) {\r\n      let index = [];\r\n      let flag = true;\r\n      for (let i = 0; i < arr_main.length; i++) {\r\n        flag = true;\r\n        for (let j = 0; j < arr_child.length; j++) {\r\n          if (arr_main[i] === arr_child[j]) {\r\n            flag = false;\r\n            break;\r\n          }\r\n        }\r\n        if (flag) {\r\n          index.push(i);\r\n        }\r\n      }\r\n      return index;\r\n    },\r\n    getIndex:function(arr, item){\r\n        for (let i=0; i<arr.length; i++){\r\n            if (arr[i] === item){\r\n                return i\r\n            }\r\n        }\r\n    },\r\n    getCookie:function(name){\r\n        var strcookie = document.cookie;\r\n        var arrcookie = strcookie.split(\"; \");\r\n        for ( var i = 0; i < arrcookie.length; i++) {\r\n            var arr = arrcookie[i].split(\"=\");\r\n            if (arr[0] == name){\r\n                return arr[1];\r\n            }\r\n        }\r\n        return \"\";\r\n    },\r\n    startExperiment:function(){\r\n        this.choose_dialog = true\r\n    },\r\n    ExperimentConfirm:function(){\r\n      let that = this\r\n        if (this.reference_col === null){\r\n            this.$message.error('请选择关联分析参考指标')\r\n        }\r\n        else if (this.checkList.length === 0){\r\n            this.$message.error('请选择需要关联分析的指标')\r\n        }\r\n        else if (this.choose_value === null){\r\n          this.$message.error('请选择关联分析算法')\r\n        }\r\n        else if (this.isInArray(this.checkList, this.reference_col)){\r\n          this.$message.error('参考指标和实验指标不能重叠')\r\n        }\r\n        else{\r\n          this.choose_col_dialog = false\r\n          this.choose_data_dialog = false\r\n          let data = {}\r\n          data['project_id'] = this.page_data[this.selected_project_index].project_id\r\n          let index_list = this.Select_Index(this.select_cols, this.checkList)\r\n          data['drop_col'] = index_list\r\n          data['special'] = this.getIndex(this.select_cols, this.reference_col)\r\n          data['path'] = this.selectfilePath\r\n          data['name'] = this.getCookie('environment_name')\r\n          data['algorithm'] = this.choose_value\r\n          startrelation(data).then(res=>{\r\n            if (res.code === 20000){\r\n              this.$message({\r\n                  type: 'success',\r\n                  message: '运行成功'\r\n              })\r\n              that.table_loading = true;\r\n              that.page_data = [];\r\n              that.tableData = [];\r\n              that.getData();\r\n              that.choose_dialog = false\r\n            }\r\n          })\r\n        }\r\n    },\r\n    chooseData:function(){\r\n        this.choose_col_dialog = true\r\n    },\r\n    Refresh: function () {\r\n      this.table_loading = true;\r\n      this.page_data = [];\r\n      this.tableData = [];\r\n      this.getData()\r\n    },\r\n    Experiment: function (val) {\r\n      this.selected_project_index = val;\r\n      this.choose_data_dialog = true;\r\n    },\r\n    getData: function () {\r\n      let that = this;\r\n      getrelationproject().then((res) => {\r\n        if (res.code === 20000) {\r\n          that.table_loading = false;\r\n          that.tableData = res.data;\r\n          let size = that.page_size;\r\n          let index = that.currentPage - 1;\r\n          for (let i = index * size; i < (index + 1) * size; i++) {\r\n            if (i == res.data.length) {\r\n              break;\r\n            }\r\n            res.data[i].tag = \"未选择\";\r\n            that.page_data.push(res.data[i]);\r\n          }\r\n          that.total_size = res.data.length;\r\n        }\r\n      });\r\n    },\r\n    getFileList: function () {\r\n      let that = this;\r\n      this.fileData = [];\r\n      getrelationfilelist().then((res) => {\r\n        if (res.code === 20000) {\r\n          let data = res.data;\r\n          for (let i = 0; i < data.length; i++) {\r\n            let dict = {};\r\n            dict[\"index\"] = i;\r\n            dict[\"name\"] = data[i].name;\r\n            dict[\"path\"] = data[i].url;\r\n            that.fileData.push(dict);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    handleSizeChange(val) {\r\n      this.table_loading = true;\r\n      this.page_size = val;\r\n      this.currentPage = 1;\r\n      this.page_data = [];\r\n      this.getData();\r\n    },\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val;\r\n      this.page_data = [];\r\n      this.getData();\r\n    },\r\n  },\r\n  mounted() {\r\n    this.getData();\r\n    this.getFileList();\r\n  },\r\n};\r\n",null]}