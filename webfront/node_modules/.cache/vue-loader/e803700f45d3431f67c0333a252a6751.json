{"remainingRequest":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectsAll\\statistics_analyze_web_2\\webfront\\src\\views\\repository\\kmeans\\result\\components\\result.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\src\\views\\repository\\kmeans\\result\\components\\result.vue","mtime":1640053529311},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { getkmeansresult, getkmenastestreport } from '@/api/model'\r\nimport chartresult from './components/resultchart'\r\nexport default {\r\n    components:{\r\n        chartresult\r\n    },\r\n    props:{\r\n        projectId:{\r\n            type: String,\r\n            required: true\r\n        }\r\n    },\r\n    data(){\r\n        return{\r\n            chart_dialog: false,\r\n            table_loading: false,\r\n            tablekey: 0,\r\n            tableData: [],\r\n            page_data: [],\r\n            total_size: 0,\r\n            currentPage: 1,\r\n            page_size: 10,\r\n            project_id: '',\r\n            filename: 'kmeans_result',\r\n            autoWidth: true,\r\n            bookType: 'xlsx',\r\n            sort_list: [],\r\n            graph_data:{\r\n                xaxis: [],\r\n                yaxis: [],\r\n                label: [],\r\n                district: [],\r\n                xlabel: '',\r\n                ylabel: ''\r\n            }\r\n        }\r\n    },\r\n    watch:{\r\n        projectId:function(a, _){\r\n            this.project_id = a\r\n            this.initTable(a)\r\n            this.page_data = []\r\n            this.tableData = []\r\n            this.sort_list = []\r\n        }\r\n    },\r\n    methods:{\r\n        showChart:function(id){\r\n            let that = this\r\n            this.graph_data.xaxis = []\r\n            this.graph_data.yaxis = []\r\n            this.graph_data.label = []\r\n            this.graph_data.district = []\r\n            this.chart_dialog = true\r\n            let chart_data = this.tableData\r\n            for (let i=0; i<chart_data.length; i++){\r\n                if (chart_data[i].sort === id){\r\n                    this.graph_data.xaxis.push(chart_data[i].xaxis)\r\n                    this.graph_data.yaxis.push(chart_data[i].yaxis)\r\n                    this.graph_data.label.push(chart_data[i].label)\r\n                    this.graph_data.district.push(chart_data[i].district)\r\n                }\r\n            }\r\n            this.graph_data.labelnum = this.sort_list.length\r\n            let dict = {}\r\n            dict['project_id'] = this.projectId\r\n            dict['sort'] = id\r\n            getkmenastestreport(dict).then(res=>{\r\n                if (res.code === 20000){\r\n                    let result = res.data[0]\r\n                    let choose_col = result.choose_col\r\n                    that.graph_data.xlabel = choose_col.split(',')[0]\r\n                    that.graph_data.ylabel = choose_col.split(',')[1]\r\n                }\r\n            })\r\n        },\r\n        timeStamptoTime:function(time){\r\n            var date = new Date(time);\r\n            let Y = date.getFullYear() + '-';\r\n            let M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';\r\n            let D = date.getDate() + ' ';\r\n            let h = date.getHours() + ':';\r\n            let m = date.getMinutes() + ':';\r\n            let s = date.getSeconds();\r\n            return Y+M+D+h+m+s;\r\n        },\r\n        handleSizeChange:function(val){\r\n            this.table_loading = true\r\n            this.page_size = val\r\n            this.currentPage = 1\r\n            this.page_data = []\r\n            this.initTable(this.project_id)\r\n        },\r\n        handleCurrentChange:function(val){\r\n            this.currentPage = val\r\n            this.page_data = []\r\n            this.initTable(this.project_id)\r\n        },\r\n        initTable:function(id){\r\n            let that = this\r\n            let dict = {}\r\n            dict['project_id'] = id\r\n            getkmeansresult(dict).then(res=>{\r\n                that.table_loading = false\r\n                that.tableData = res.data\r\n                for (let i=0; i<res.data.length; i++){\r\n                    let time = res.data[i].time\r\n                    time = new Date(time.replace(/-/g,'/')).getTime()+3600*1000*8\r\n                    res.data[i].time = that.timeStamptoTime(time)\r\n                }\r\n                let size = that.page_size\r\n                let index = that.currentPage-1\r\n                for (let i=index*size; i<(index+1)*size; i++){\r\n                    if (i==res.data.length){\r\n                        break\r\n                    }\r\n                    that.page_data.push(res.data[i])\r\n                }\r\n                that.total_size = res.data.length\r\n                for (let i=0; i<that.tableData.length; i++){\r\n                    if (!that.isInArray(that.sort_list, that.tableData[i].sort)){\r\n                        that.sort_list.push(that.tableData[i].sort)\r\n                    }\r\n                }\r\n                that.$emit('child-event', that.sort_list)\r\n            })\r\n        },\r\n        isInArray:function(arr,value){\r\n            for(var i = 0; i < arr.length; i++){\r\n                if(value === arr[i]){\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        },\r\n        formatJson(filterVal, jsonData) {\r\n            return jsonData.map(v => filterVal.map(j => {\r\n                if (j === 'timestamp') {\r\n                return parseTime(v[j])\r\n                } else {\r\n                return v[j]\r\n                }\r\n            }))\r\n        },\r\n        download:function(){\r\n            import('@/vendor/Export2Excel').then(excel => {\r\n                const tHeader = ['xAxis', 'yAxis', 'Label', 'DateTime', 'Sort']\r\n                const filterVal = ['xaxis', 'yaxis', 'label', 'time', 'sort']\r\n                const list = this.tableData\r\n                const data = this.formatJson(filterVal, list)\r\n                excel.export_json_to_excel({\r\n                header: tHeader,\r\n                data,\r\n                filename: this.filename,\r\n                autoWidth: this.autoWidth,\r\n                bookType: this.bookType\r\n                })\r\n            })\r\n        }\r\n    },\r\n    mounted(){\r\n\r\n    }\r\n}\r\n",null]}