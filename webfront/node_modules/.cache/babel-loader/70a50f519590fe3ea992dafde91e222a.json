{"remainingRequest":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\babel-loader\\lib\\index.js!D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\projectsAll\\statistics_analyze_web_2\\webfront\\src\\views\\tree\\components\\transfer.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\src\\views\\tree\\components\\transfer.vue","mtime":1609073358507},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\projectsAll\\statistics_analyze_web_2\\webfront\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/projectsAll/statistics_analyze_web_2/webfront/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nvar _interopRequireWildcard2 = _interopRequireDefault(require(\"D:/projectsAll/statistics_analyze_web_2/webfront/node_modules/@babel/runtime/helpers/interopRequireWildcard\"));\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _model = require(\"@/api/model\");\n\nvar _vueAmap = _interopRequireDefault(require(\"vue-amap\"));\n\nvar _vue = _interopRequireDefault(require(\"vue\"));\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n_vue.default.use(_vueAmap.default);\n\n_vueAmap.default.initAMapApiLoader({\n  key: 'b84d5392efeafdc572f53e8de8dfd501',\n  plugin: ['AMap.Autocomplete', 'AMap.PlaceSearch', 'AMap.Scale', 'AMap.OverView', 'AMap.ToolBar', 'AMap.MapType', 'AMap.PolyEditor', 'AMap.CircleEditor', 'AMap.Geolocation', 'Geocoder']\n});\n\nvar _default = {\n  data: function data() {\n    var self = this;\n    return {\n      table_loading: false,\n      tablekey: 0,\n      tableData: [],\n      page_data: [],\n      total_size: 0,\n      currentPage: 1,\n      page_size: 10,\n      amend_dialog: false,\n      form: {},\n      delete_form: {},\n      delete_dialog: false,\n      add_dialog: false,\n      add_form: {\n        name: '',\n        address: '',\n        longitude: '',\n        latitude: '',\n        capacity: '',\n        district: ''\n      },\n      map_dialog: false,\n      zoom: 15,\n      center: [121.456848, 31.274044],\n      plugin: [{\n        pName: 'Geolocation',\n        events: {}\n      }],\n      searchOption: {\n        city: '上海',\n        citylimit: false\n      },\n      events: {\n        click: function click(e) {\n          var _e$lnglat = e.lnglat,\n              lng = _e$lnglat.lng,\n              lat = _e$lnglat.lat;\n          self.add_form.longitude = lng;\n          self.add_form.latitude = lat; // 这里通过高德 SDK 完成。\n\n          var geocoder = new AMap.Geocoder({\n            radius: 1000,\n            extensions: 'all'\n          });\n          geocoder.getAddress([lng, lat], function (status, result) {\n            if (status === 'complete' && result.info === 'OK') {\n              if (result && result.regeocode) {\n                self.add_form.address = result.regeocode.formattedAddress;\n                self.add_form.name = result.regeocode.aois[0].name;\n                self.add_form.district = result.regeocode.addressComponent.district;\n                self.$nextTick();\n                self.$message({\n                  message: '获取位置成功',\n                  type: 'success'\n                });\n                self.map_dialog = false;\n              }\n            }\n          });\n        }\n      },\n      filename: 'transfer_factory',\n      autoWidth: true,\n      bookType: 'xlsx'\n    };\n  },\n  methods: {\n    formatJson: function formatJson(filterVal, jsonData) {\n      return jsonData.map(function (v) {\n        return filterVal.map(function (j) {\n          if (j === 'timestamp') {\n            return parseTime(v[j]);\n          } else {\n            return v[j];\n          }\n        });\n      });\n    },\n    DownLoad: function DownLoad() {\n      var _this = this;\n\n      Promise.resolve().then(function () {\n        return (0, _interopRequireWildcard2.default)(require('@/vendor/Export2Excel'));\n      }).then(function (excel) {\n        var tHeader = ['name', 'address', 'longitude', 'latitude', 'capacity', 'district'];\n        var filterVal = ['name', 'address', 'longitude', 'latitude', 'capacity', 'district'];\n        var list = _this.tableData;\n\n        var data = _this.formatJson(filterVal, list);\n\n        excel.export_json_to_excel({\n          header: tHeader,\n          data: data,\n          filename: _this.filename,\n          autoWidth: _this.autoWidth,\n          bookType: _this.bookType\n        });\n      });\n    },\n    onSearchResult: function onSearchResult(pois) {\n      var latSum = 0;\n      var lngSum = 0;\n\n      if (pois.length > 0) {\n        pois.forEach(function (poi) {\n          var lng = poi.lng,\n              lat = poi.lat;\n          lngSum += lng;\n          latSum += lat;\n        });\n        var cent = {\n          lng: lngSum / pois.length,\n          lat: latSum / pois.length\n        };\n        this.center = [cent.lng, cent.lat];\n      }\n    },\n    addData: function addData() {\n      this.add_dialog = true;\n    },\n    AddDataConfirm: function AddDataConfirm() {\n      var _this2 = this;\n\n      var that = this;\n\n      if (this.add_form.name === '' || this.add_form.address === '' || this.add_form.longitude === '' || this.add_form.latitude === '' || this.add_form.capacity === '' || this.add_form.district === '') {\n        this.$message.error('表格信息不完整，请完善信息');\n      } else {\n        (0, _model.addtransferfactorybyrow)(this.add_form).then(function (res) {\n          if (res.code === 20000) {\n            _this2.$message({\n              type: 'success',\n              message: '添加成功'\n            });\n\n            that.page_data = [];\n            that.add_dialog = false;\n            that.getData();\n          }\n        });\n      }\n    },\n    showmap: function showmap() {\n      this.map_dialog = true;\n    },\n    getData: function getData() {\n      var that = this;\n      (0, _model.gettransferfactory)().then(function (res) {\n        if (res.code === 20000) {\n          that.table_loading = false;\n          that.tableData = res.data;\n          var size = that.page_size;\n          var index = that.currentPage - 1;\n\n          for (var i = index * size; i < (index + 1) * size; i++) {\n            if (i == res.data.length) {\n              break;\n            }\n\n            that.page_data.push(res.data[i]);\n          }\n\n          that.total_size = res.data.length;\n        }\n      });\n    },\n    handleSizeChange: function handleSizeChange(val) {\n      this.table_loading = true;\n      this.page_size = val;\n      this.currentPage = 1;\n      this.page_data = [];\n      this.getData();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.currentPage = val;\n      this.page_data = [];\n      this.getData();\n    },\n    AmendData: function AmendData(val) {\n      this.form = this.page_data[val];\n      this.amend_dialog = true;\n    },\n    DeleteData: function DeleteData(val) {\n      this.delete_dialog = true;\n      this.delete_form.id = this.page_data[val].id;\n    },\n    AmendDataConfirm: function AmendDataConfirm() {\n      var _this3 = this;\n\n      var that = this;\n      (0, _model.amendtransferfactory)(this.form).then(function (res) {\n        if (res.code === 20000) {\n          _this3.$message({\n            type: 'success',\n            message: '修改成功'\n          });\n\n          that.page_data = [];\n          that.getData();\n          that.amend_dialog = false;\n        }\n      });\n    },\n    DeleteDataConfirm: function DeleteDataConfirm() {\n      var that = this;\n      (0, _model.deletetransferfactory)(this.delete_form).then(function (res) {\n        if (res.code === 20000) {\n          that.$message({\n            type: 'success',\n            message: '删除成功'\n          });\n          that.page_data = [];\n          that.delete_dialog = false;\n          that.getData();\n        }\n      });\n    }\n  },\n  mounted: function mounted() {\n    this.getData();\n  }\n};\nexports.default = _default;",null]}